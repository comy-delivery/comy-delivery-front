<div class="bg-primary p-5 text-white">
  <div class="container">
    <div class="d-flex align-items-center gap-3">
      <img
        *ngIf="logoUrl"
        [src]="logoUrl"
        alt="logo"
        style="width: 64px; height: 64px; border-radius: 8px; object-fit: cover"
      />
      <div>
        <p class="fs-4 mb-0">Painel Administrativo</p>
        <p class="fs-5 mb-0">{{ Restaurante.nmRestaurante }}</p>
      </div>
    </div>
    <div class="row gap-lg-0 gap-md-2 gap-sm-2 gap-2">
      <div class="col-lg-3 col-md-6 col-sm-12 col-12 mb-3">
        <div class="card bg-info bg-opacity-25 p-3 rounded-4 h-100">
          <div class="row">
            <div class="col-10">
              <div class="d-flex flex-column text-white">
                <p class="card-text m-0 opacity-75">Novos Pedidos</p>
                <h2 class="text-white m-0">{{ getCountByStatus('PENDENTE') }}</h2>
              </div>
            </div>
            <div class="col align-content-center text-warning">
              <span class="fs-1">¬©</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 col-sm-12 col-12 mb-3">
        <div class="card bg-info bg-opacity-25 p-3 rounded-4 h-100">
          <div class="row">
            <div class="col-10">
              <div class="d-flex flex-column text-white">
                <p class="card-text m-0 opacity-75">Em Preparo</p>
                <h2 class="text-white m-0">
                  {{ getCountByStatuses(['EM_PREPARACAO', 'CONFIRMADO', 'A_CAMINHO']) }}
                </h2>
              </div>
            </div>
            <div class="col align-content-center text-success">
              <span class="fs-1">‚è≤Ô∏è</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 col-sm-12 col-12 mb-3">
        <div class="card bg-info bg-opacity-25 p-3 rounded-4 h-100">
          <div class="row">
            <div class="col-10">
              <div class="d-flex flex-column text-white">
                <p class="card-text m-0 opacity-75">Produtos</p>
                <h2 class="text-white m-0">{{ produtos.length }}</h2>
              </div>
            </div>
            <div class="col align-content-center text-danger">
              <span class="fs-1">üçï</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 col-sm-12 col-12 mb-3">
        <div class="card bg-info bg-opacity-25 p-3 rounded-4 h-100">
          <div class="row">
            <div class="col-10">
              <div class="d-flex flex-column text-white">
                <p class="card-text m-0 opacity-75">Receita Hoje</p>
                <h2 class="text-white m-0">R$ {{ getReceitaHoje() }}</h2>
              </div>
            </div>
            <div class="col align-content-center text-success">
              <span class="fs-1">$</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="bg-body border-bottom">
  <div class="container">
    <div class="d-flex gap-3 py-3 justify-content-center">
      <button
        class="btn btn-outline-secondary rounded-pill px-4 py-2 fw-semibold d-flex align-items-center gap-2"
        (click)="ativarTab('pedidos')"
      >
        Pedidos
        <span
          class="badge bg-warning text-dark rounded-circle fw-semibold"
          style="
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
          "
        >
          {{ pedidos.length }}
        </span>
      </button>

      <button
        class="btn btn-outline-secondary rounded-pill px-4 py-2 fw-semibold d-flex align-items-center gap-2"
        (click)="ativarTab('produtos')"
      >
        Produtos
        <span class="badge bg-secondary text-white ms-2">{{ produtos.length }}</span>
      </button>
    </div>
  </div>
</div>

<div class="container mt-4 mb-5">
  <div *ngIf="tabAtiva === 'pedidos'">
    <h3>Novos Pedidos</h3>

    <div class="mt-4" *ngIf="pedidos.length > 0">
      <div class="row g-3">
        <div class="col-12" *ngFor="let ped of pedidos">
          <div class="card p-3">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <strong>#{{ ped.idPedido }}</strong>
                <div class="small text-muted">Cliente: Cliente</div>
                <div class="small text-muted">Total: R$ {{ ped.vlTotal }}</div>
                <div class="small text-muted">Status: {{ ped.status }}</div>
                <div class="small text-muted">Criado: {{ ped.dtCriacao }}</div>
              </div>
              <div class="text-end">
                <button class="btn btn-sm btn-success mb-1" (click)="ped.status = 'CONFIRMADO'">
                  Confirmar
                </button>
                <button class="btn btn-sm btn-danger mb-1" (click)="ped.status = 'CANCELADO'">
                  Recusar
                </button>
              </div>
            </div>
            <div class="mt-3">
              <pedido-restaurante [pedido]="ped"></pedido-restaurante>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="pedidos.length === 0" class="text-center text-muted mt-5">
      <p>Nenhum pedido novo no momento.</p>
    </div>
  </div>

  <div *ngIf="tabAtiva === 'produtos'">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3>Gerenciar Produtos</h3>
      <button class="btn btn-primary" (click)="abrirModalAdicionar()">+ Adicionar Produto</button>
    </div>

    <div class="produtos-grid">
      <app-produto-restaurante
        *ngFor="let produto of produtos"
        [produto]="produto"
        (onEditar)="editarProduto($event)"
        (onRemover)="confirmRemover($event)"
      >
      </app-produto-restaurante>
    </div>

    <div *ngIf="produtos.length === 0" class="text-center text-muted mt-5">
      <p>Nenhum produto cadastrado. Clique em "Adicionar Produto" para come√ßar.</p>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="mostrarModal" (click)="fecharModal()">
  <div class="modal-dialog modal-lg" (click)="$event.stopPropagation()">
    <div class="modal-content" style="max-height: 90vh; overflow-y: auto">
      <div class="modal-header">
        <h5 class="modal-title">{{ modoEdicao ? 'Editar Produto' : 'Adicionar Produto' }}</h5>
        <button type="button" class="btn-close" (click)="fecharModal()"></button>
      </div>

      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label class="form-label">Nome do Produto*</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="produtoAtual.nmProduto"
              name="nome"
              placeholder="Ex: Pizza Margherita"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Descri√ß√£o*</label>
            <textarea
              class="form-control"
              [(ngModel)]="produtoAtual.descricao"
              name="descricao"
              placeholder="Ingredientes ou detalhes do produto"
              rows="3"
              required
            ></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Categoria*</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="produtoAtual.categoria"
              name="categoria"
              placeholder="Ex: Pizzas, Bebidas, Sobremesas"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Pre√ßo (R$)*</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="produtoAtual.preco"
              name="preco"
              placeholder="0.00"
              step="0.01"
              min="0"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">URL da Imagem</label>
            <input
              type="file"
              class="form-control"
              [(ngModel)]="produtoAtual.imagemProduto"
              name="imagem"
              accept="image/*"
            />
          </div>

          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <label class="form-label fw-bold mb-1">‚ûï Adicionais deste Produto</label>
                <p class="text-muted small mb-0">
                  Cadastre op√ß√µes extras que o cliente poder√° escolher
                </p>
              </div>
              <button
                type="button"
                class="btn btn-success btn-sm"
                (click)="adicionarNovoAdicionalAoProduto()"
              >
                + Novo Adicional
              </button>
            </div>

            <div
              *ngIf="adicionaisTemporarios.length > 0"
              class="border rounded p-3 bg-light"
              style="max-height: 400px; overflow-y: auto"
            >
              <div
                *ngFor="let adicional of adicionaisTemporarios; let i = index"
                class="card mb-3 shadow-sm"
              >
                <div class="card-body p-3">
                  <div class="row g-2">
                    <div class="col-md-5">
                      <label class="form-label small mb-1">Nome do Adicional*</label>
                      <input
                        type="text"
                        class="form-control form-control-sm"
                        [(ngModel)]="adicional.nome"
                        [name]="'adicional-nome-' + i"
                        placeholder="Ex: Queijo Extra"
                        required
                      />
                    </div>

                    <div class="col-md-3">
                      <label class="form-label small mb-1">Pre√ßo (R$)*</label>
                      <input
                        type="number"
                        class="form-control form-control-sm"
                        [(ngModel)]="adicional.preco"
                        [name]="'adicional-preco-' + i"
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                        required
                      />
                    </div>

                    <div class="col-md-3">
                      <label class="form-label small mb-1">Descri√ß√£o</label>
                      <input
                        type="text"
                        class="form-control form-control-sm"
                        [(ngModel)]="adicional.descricao"
                        [name]="'adicional-desc-' + i"
                        placeholder="Opcional"
                      />
                    </div>

                    <div class="col-md-1 d-flex align-items-end">
                      <button
                        type="button"
                        class="btn btn-danger btn-sm w-100"
                        (click)="removerAdicionalTemporario(i)"
                        title="Remover adicional"
                      >
                        üóëÔ∏è
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div
              *ngIf="adicionaisTemporarios.length === 0"
              class="text-center border rounded p-4 bg-light"
            >
              <p class="text-muted mb-2">üìù Nenhum adicional cadastrado para este produto.</p>
              <small class="text-muted"
                >Clique em "Novo Adicional" para adicionar op√ß√µes como queijo extra, bacon,
                etc.</small
              >
            </div>

            <div
              *ngIf="adicionaisTemporarios.length > 0"
              class="alert alert-success mt-3 mb-0 py-2"
            >
              <small>
                <i class="bi bi-check-circle"></i>
                <strong>{{ adicionaisTemporarios.length }}</strong> adicional(is) cadastrado(s) para
                este produto
              </small>
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button type="button" class="btn btn-secondary flex-fill" (click)="fecharModal()">
              Cancelar
            </button>
            <button type="button" class="btn btn-primary flex-fill" (click)="salvarProduto()">
              {{ modoEdicao ? 'Salvar Altera√ß√µes' : 'Adicionar Produto' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
